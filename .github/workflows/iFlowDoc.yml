name: üîê Test Groq API Key

on:
  workflow_dispatch:  # Run manually

jobs:
  test-key:
    runs-on: ubuntu-latest

    steps:
      - name: Test Groq API Key
        env:
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        run: |
          echo "üîç Checking if Groq API Key is present..."

          # Check if key is empty
          if [ -z "$GROQ_API_KEY" ]; then
            echo "‚ùå ERROR: GROQ_API_KEY secret is NOT SET or EMPTY."
            exit 1
          fi

          echo "‚úî Key exists (value masked). Testing validity against Groq API..."

          # Make test request
          RESPONSE=$(curl -s -X GET "https://api.groq.com/openai/v1/models" \
            -H "Authorization: Bearer $GROQ_API_KEY")

          echo "üîé API Response:"
          echo "$RESPONSE"

          # Check for invalid key
          if echo "$RESPONSE" | grep -q "invalid_api_key"; then
            echo "‚ùå INVALID KEY: Your Groq API key is NOT VALID."
            exit 1
          fi

          # Check for valid response
          if echo "$RESPONSE" | grep -q "data"; then
            echo "üéâ SUCCESS: Your Groq API key is VALID!"
            exit 0
          fi

          echo "‚ö† Unexpected response from Groq API. Key might be invalid or API unavailable."
          exit 1
